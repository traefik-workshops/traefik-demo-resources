---
# Pricing API - Automated fare calculation
apiVersion: v1
kind: ConfigMap
metadata:
  name: pricing-data
  namespace: airlines
data:
  api.json: |
    {
      "pricing": {
        "calculate": {"default": {}},
        "FL123": {"base_fare": 400, "taxes": 50, "total": 450},
        "JFK-LAX": {"economy": 400, "premium_economy": 650, "business": 1200, "first": 2500},
        "LAX-JFK": {"economy": 410, "premium_economy": 660, "business": 1250, "first": 2600},
        "SFO-NRT": {"economy": 850, "premium_economy": 1400, "business": 4500, "first": 8500},
        "LHR-JFK": {"economy": 550, "premium_economy": 900, "business": 2800, "first": 6000}
      },
      "taxes_fees": {"domestic": 50, "international": 120}
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pricing-openapi
  namespace: airlines
data:
  openapi.yaml: |
    openapi: "3.0.0"
    info:
      version: 1.0.0
      title: Pricing API
    servers:
      - url: {{ include "airlines.pricing.apiUrl" . }}
    paths:
      /pricing/FL123:
        get:
          responses:
            200:
              description: Calculated pricing
              content:
                application/json:
                  schema:
                    $ref: '#/components/schemas/Pricing'
      /pricing/calculate:
        post:
          summary: Calculate flight pricing
          operationId: calculatePricing
          responses:
            200:
              description: Calculated pricing
              content:
                application/json:
                  schema:
                    type: object
    components:
      schemas:
        Pricing:
          type: object
          properties:
            base_fare:
              type: number
            taxes:
              type: number
            total:
              type: number

{{ include "airlines.serviceDeployment" (dict "root" . "name" "pricing") }}

---
apiVersion: v1
kind: Service
metadata:
  name: pricing-app
  namespace: airlines
spec:
  ports:
    - port: 3000
  selector:
    app: pricing-app
