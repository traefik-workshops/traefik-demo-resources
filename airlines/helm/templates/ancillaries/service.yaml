---
# Ancillaries API - Meals, Upgrades & Services
apiVersion: v1
kind: ConfigMap
metadata:
  name: ancillaries-data
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: ancillaries
data:
  api.json: |
    {
      "ancillaries": {
        "meal": {"default": {}}
      },
      "meals": {
        "standard": {"name": "Standard Meal", "price": 0, "description": "Regular in-flight meal"},
        "vegetarian": {"name": "Vegetarian Meal", "price": 0, "description": "Meat-free meal"},
        "vegan": {"name": "Vegan Meal", "price": 0, "description": "Plant-based meal"},
        "kosher": {"name": "Kosher Meal", "price": 15.00, "description": "Certified Kosher meal"},
        "halal": {"name": "Halal Meal", "price": 15.00, "description": "Certified Halal meal"},
        "gluten_free": {"name": "Gluten-Free Meal", "price": 10.00, "description": "Gluten-free meal"}
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ancillaries-openapi
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: ancillaries
data:
  openapi.yaml: |
    openapi: "3.0.0"
    info:
      version: 1.0.0
      title: Ancillaries API
      description: Management of ancillary services like meals and upgrades
    servers:
      - url: {{ include "airlines.ancillaries.apiUrl" . }}
    paths:
      /ancillaries/meals:
        get:
          summary: Get available meal options
          operationId: getMealOptions
          responses:
            200:
              description: Available meal options
              content:
                application/json:
                  schema:
                    type: object
                    additionalProperties:
                      $ref: '#/components/schemas/Meal'
      /ancillaries/meal:
        post:
          summary: Record meal preference
          operationId: recordMealPreference
          responses:
            200:
              description: Meal preference recorded
              content:
                application/json:
                  schema:
                    type: object
      /ancillaries/seat-upgrade:
        post:
          summary: Upgrade seat
          operationId: upgradeSeat
          requestBody:
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    booking_id: {type: string}
                    new_seat: {type: string}
          responses:
            200:
              description: Seat upgraded
              content:
                application/json:
                  schema:
                    type: object
      /ancillaries:
        post:
          summary: Add ancillary service
          operationId: addAncillary
          requestBody:
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    booking_id: {type: string}
                    type: {type: string}
                    preference: {type: string}
          responses:
            200:
              description: Ancillary service recorded
              content:
                application/json:
                  schema:
                    type: object

    components:
      schemas:
        Meal:
          type: object
          properties:
            name:
              type: string
            price:
              type: number
            description:
              type: string

{{- include "airlines.serviceDeployment" (dict "root" . "name" "ancillaries") -}}

---
apiVersion: v1
kind: Service
metadata:
  name: ancillaries-app
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: ancillaries
spec:
  type: ClusterIP
  ports:
    - port: 3000
      targetPort: 3000
      name: http
  selector:
    app: ancillaries-app
