---
# Airlines API Portal - Developer Portal for all Airlines APIs
apiVersion: hub.traefik.io/v1alpha1
kind: APIPortal
metadata:
  name: airlines-portal
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
spec:
  title: "Traefik Airlines API Portal"
  description: |
    ## Traefik Airlines API Portal
    
    This portal provides access to all Traefik Airlines APIs, demonstrating the 
    **Triple Gateway Pattern** with API Gateway, MCP Gateway, and AI Gateway.

    ### Triple Gateway Architecture
    
    This platform demonstrates three layers of gateway protection:
    
    **API Gateway** (Traefik Hub)
    - Authentication & Authorization
    - Rate limiting
    - API versioning and lifecycle
    - WAF
    
    **MCP Gateway** (Traefik MCP Middleware)
    - MCP protocol enforcement
    - Tool/action authorization
    - Workflow-based access control
    - Audit logging
    
    **AI Gateway** (Traefik AI Middleware)
    - LLM request routing
    - Prompt filtering
    - Request/Response guardrails
    - Cost allocation
    
    ---

    **Built with ❤️ by Traefik Labs**
  trustedUrls:
    - https://portal.{{ .Values.domain }}
  auth:
    name: oidc-portal-auth
---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: airlines-portal
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
  annotations:
    hub.traefik.io/api-portal: airlines-portal
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
  - match: {{ include "airlines.portal.hostMatch" . }}
    kind: Rule
    services:
    - name: apiportal
      namespace: traefik
      port: 9903
---
apiVersion: hub.traefik.io/v1alpha1
kind: APICatalogItem
metadata:
  name: airlines-access
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
spec:
  everyone: true
  apis:
    - name: flights-api
    - name: pricing-api
    - name: tickets-api
  apiPlan:
    name: open-access
---
apiVersion: hub.traefik.io/v1alpha1
kind: APICatalogItem
metadata:
  name: airlines-access
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
spec:
  groups:
    - users
  apis:
    - name: baggage-api
    - name: bookings-api
    - name: checkin-api
    - name: loyalty-api
    - name: notifications-api
    - name: user-assistance-api
  apiPlan:
    name: airlines-access
---
apiVersion: hub.traefik.io/v1alpha1
kind: APICatalogItem
metadata:
  name: airlines-admins-access
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
spec:
  groups:
    - admins
  apis:
    - name: ancillaries-api
    - name: baggage-api
    - name: bookings-api
    - name: checkin-api
    - name: loyalty-api
    - name: notifications-api
    - name: passengers-api
    - name: partner-assistance-api
    - name: ticketing-agent-api
    - name: user-assistance-api
  apiPlan:
    name: airlines-admins-access
