---
# User Assistance MCP API - Customer Support Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: user-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  title: "User Assistance MCP"
  description: "Customer Support & Disruption Management - MCP tools for handling customer issues, flight disruptions, and support requests"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Ticketing Agent MCP API - Sales & Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: ticketing-agent-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  title: "Ticketing Agent MCP"
  description: "Sales & Ticketing Operations - MCP tools for booking, ticketing, check-in, and passenger services"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Partner Assistance MCP API - B2B Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: partner-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  title: "Partner Assistance MCP"
  description: "B2B & Alliance Operations - MCP tools for managing partner airlines, codeshares, and alliance operations"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# MCP Middleware for User Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: user-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # Flight Information & Status (User Assistance specific)
        - match: Equals(`mcp.params.name`, `get_flight_status`) || Equals(`mcp.params.name`, `find_delayed_flights`) || Equals(`mcp.params.name`, `find_alternative_flights`) || Equals(`mcp.params.name`, `track_flight_realtime`) || Equals(`mcp.params.name`, `get_gate_info`)
          action: show
        # Booking Management (read-only)
        - match: Prefix(`mcp.params.name`, `get_booking`) || Prefix(`mcp.params.name`, `search_bookings`)
          action: show
        # Passenger Information
        - match: Prefix(`mcp.params.name`, `get_passenger`) || Prefix(`mcp.params.name`, `update_passenger`)
          action: show
        # Baggage Services
        - match: Prefix(`mcp.params.name`, `track_baggage`) || Prefix(`mcp.params.name`, `report_baggage`) || Prefix(`mcp.params.name`, `update_baggage`)
          action: show
        # Loyalty Program
        - match: Prefix(`mcp.params.name`, `get_loyalty_p`) || Prefix(`mcp.params.name`, `search_loyalty`) || Prefix(`mcp.params.name`, `add_missing`)
          action: show
        # Compensation & Refunds
        - match: Prefix(`mcp.params.name`, `calculate_delay`) || Prefix(`mcp.params.name`, `process_refund`) || Prefix(`mcp.params.name`, `issue_travel`)
          action: show
        # Notifications
        - match: Prefix(`mcp.params.name`, `send_notification`) || Prefix(`mcp.params.name`, `get_notification`)
          action: show
      listDefaultAction: hide
---
# MCP Middleware for Ticketing Agent
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: ticketing-agent-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # Flight Search & Availability (Ticketing specific)
        - match: Equals(`mcp.params.name`, `search_flights`) || Equals(`mcp.params.name`, `search_available_flights`) || Equals(`mcp.params.name`, `find_flights_to_destination`) || Equals(`mcp.params.name`, `find_flights_from_origin`)
          action: show
        # Pricing
        - match: Equals(`mcp.params.name`, `get_flight_pricing`) || Equals(`mcp.params.name`, `calculate_total_trip_price`)
          action: show
        # Booking Operations
        - match: Equals(`mcp.params.name`, `book_flight_itinerary`) || Equals(`mcp.params.name`, `modify_booking`) || Equals(`mcp.params.name`, `cancel_booking_with_refund`) || Equals(`mcp.params.name`, `verify_change_refund_eligibility`)
          action: show
        # Check-in & Boarding
        - match: Equals(`mcp.params.name`, `check_in_and_generate_boarding_pass`) || Equals(`mcp.params.name`, `check_standby_status`)
          action: show
        # Seat & Ancillaries
        - match: Equals(`mcp.params.name`, `select_seat`) || Equals(`mcp.params.name`, `manage_baggage`) || Equals(`mcp.params.name`, `update_meal_preference`)
          action: show
        # Loyalty Operations
        - match: Equals(`mcp.params.name`, `get_loyalty_status`) || Equals(`mcp.params.name`, `redeem_miles_for_flight`)
          action: show
      listDefaultAction: hide
      description: "Ticketing and sales tools for booking, modifications, and passenger services"
---
# MCP Middleware for Partner Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: partner-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # Partner & Alliance Operations
        - match: Prefix(`mcp.params.name`, `enroll_partner`) || Prefix(`mcp.params.name`, `update_partner`) || Prefix(`mcp.params.name`, `create_alliance`) || Prefix(`mcp.params.name`, `reconcile_partner`)
          action: show
        # Airport & Manifest Operations
        - match: Prefix(`mcp.params.name`, `get_airport`) || Prefix(`mcp.params.name`, `generate_passenger`)
          action: show
      listDefaultAction: hide
---
# IngressRoute for User Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: user-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
  annotations:
    hub.traefik.io/api: user-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`user-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: user-assistance-mcp
---
# IngressRoute for Ticketing Agent MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: ticketing-agent-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
  annotations:
    hub.traefik.io/api: ticketing-agent-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`ticketing-agent.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: ticketing-agent-mcp
---
# IngressRoute for Partner Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: partner-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
  annotations:
    hub.traefik.io/api: partner-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`partner-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: partner-assistance-mcp
