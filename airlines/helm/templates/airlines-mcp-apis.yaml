---
# User Assistance MCP API - Customer Support Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: user-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  title: "User Assistance MCP"
  description: "Customer Support & Disruption Management - MCP tools for handling customer issues, flight disruptions, and support requests"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Ticketing Agent MCP API - Sales & Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: ticketing-agent-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  title: "Ticketing Agent MCP"
  description: "Sales & Ticketing Operations - MCP tools for booking, ticketing, check-in, and passenger services"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Partner Assistance MCP API - B2B Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: partner-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  title: "Partner Assistance MCP"
  description: "B2B & Alliance Operations - MCP tools for managing partner airlines, codeshares, and alliance operations"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# MCP Middleware for User Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: user-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # Flight Information & Status (User Assistance only gets read tools)
        - match: Equals(`mcp.params.name`, `get_flight_status`)
          action: show
        - match: Equals(`mcp.params.name`, `find_delayed_flights`)
          action: show
        - match: Equals(`mcp.params.name`, `find_alternative_flights`)
          action: show
        - match: Equals(`mcp.params.name`, `track_flight_realtime`)
          action: show
        - match: Equals(`mcp.params.name`, `get_gate_info`)
          action: show
        # Booking Management (read-only)
        - match: Equals(`mcp.params.name`, `get_booking_details`)
          action: show
        - match: Equals(`mcp.params.name`, `search_bookings_by_passenger`)
          action: show
        # Passenger Information
        - match: Equals(`mcp.params.name`, `update_passenger_contact_info`)
          action: show
        - match: Equals(`mcp.params.name`, `get_passenger_details`)
          action: show
        # Baggage Services
        - match: Equals(`mcp.params.name`, `track_baggage`)
          action: show
        - match: Equals(`mcp.params.name`, `report_baggage_issue`)
          action: show
        - match: Equals(`mcp.params.name`, `update_baggage_status`)
          action: show
        # Loyalty Program
        - match: Equals(`mcp.params.name`, `get_loyalty_profile`)
          action: show
        - match: Equals(`mcp.params.name`, `search_loyalty_by_passenger`)
          action: show
        - match: Equals(`mcp.params.name`, `add_missing_miles`)
          action: show
        # Compensation & Refunds
        - match: Equals(`mcp.params.name`, `calculate_delay_compensation`)
          action: show
        - match: Equals(`mcp.params.name`, `process_refund_request`)
          action: show
        - match: Equals(`mcp.params.name`, `issue_travel_voucher`)
          action: show
        # Notifications
        - match: Equals(`mcp.params.name`, `send_notification`)
          action: show
        - match: Equals(`mcp.params.name`, `get_notification_history`)
          action: show
      listDefaultAction: hide
---
# MCP Middleware for Ticketing Agent
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: ticketing-agent-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # Flight Search & Availability
        - match: Equals(`mcp.params.name`, `search_flights`)
          action: show
        - match: Equals(`mcp.params.name`, `search_multi_city_flights`)
          action: show
        - match: Equals(`mcp.params.name`, `check_seat_availability`)
          action: show
        - match: Equals(`mcp.params.name`, `check_flight_load_factor`)
          action: show
        - match: Equals(`mcp.params.name`, `search_available_flights`)
          action: show
        - match: Equals(`mcp.params.name`, `find_flights_to_destination`)
          action: show
        - match: Equals(`mcp.params.name`, `find_flights_from_origin`)
          action: show
        # Pricing
        - match: Equals(`mcp.params.name`, `get_flight_pricing`)
          action: show
        - match: Equals(`mcp.params.name`, `calculate_total_trip_price`)
          action: show
        - match: Equals(`mcp.params.name`, `compare_fare_classes`)
          action: show
        # Booking Creation
        - match: Equals(`mcp.params.name`, `book_flight_itinerary`)
          action: show
        - match: Equals(`mcp.params.name`, `create_group_booking`)
          action: show
        - match: Equals(`mcp.params.name`, `book_round_trip`)
          action: show
        # Booking Modifications
        - match: Equals(`mcp.params.name`, `modify_booking`)
          action: show
        - match: Equals(`mcp.params.name`, `rebook_disrupted_passenger`)
          action: show
        - match: Equals(`mcp.params.name`, `split_booking`)
          action: show
        - match: Equals(`mcp.params.name`, `add_segment_to_booking`)
          action: show
        - match: Equals(`mcp.params.name`, `verify_change_refund_eligibility`)
          action: show
        - match: Equals(`mcp.params.name`, `cancel_booking_with_refund`)
          action: show
        # Check-in & Boarding
        - match: Equals(`mcp.params.name`, `check_in_and_generate_boarding_pass`)
          action: show
        - match: Equals(`mcp.params.name`, `check_in_group`)
          action: show
        - match: Equals(`mcp.params.name`, `get_boarding_pass`)
          action: show
        - match: Equals(`mcp.params.name`, `update_checkin_status`)
          action: show
        - match: Equals(`mcp.params.name`, `resend_boarding_pass`)
          action: show
        # Seat Selection
        - match: Equals(`mcp.params.name`, `select_seat`)
          action: show
        - match: Equals(`mcp.params.name`, `auto_assign_seats`)
          action: show
        - match: Equals(`mcp.params.name`, `view_seat_map`)
          action: show
        # Ancillary Services
        - match: Equals(`mcp.params.name`, `purchase_ancillary_services`)
          action: show
        - match: Equals(`mcp.params.name`, `list_available_ancillaries`)
          action: show
        - match: Equals(`mcp.params.name`, `manage_baggage`)
          action: show
        - match: Equals(`mcp.params.name`, `update_meal_preference`)
          action: show
        # Special Requests & Services
        - match: Equals(`mcp.params.name`, `request_special_assistance`)
          action: show
        - match: Equals(`mcp.params.name`, `add_infant_to_booking`)
          action: show
        # Upgrades
        - match: Equals(`mcp.params.name`, `request_cabin_upgrade`)
          action: show
        - match: Equals(`mcp.params.name`, `process_complimentary_upgrade`)
          action: show
        - match: Equals(`mcp.params.name`, `add_to_upgrade_waitlist`)
          action: show
        # Standby Management
        - match: Equals(`mcp.params.name`, `add_to_standby_list`)
          action: show
        - match: Equals(`mcp.params.name`, `check_standby_status`)
          action: show
        - match: Equals(`mcp.params.name`, `clear_standby_passenger`)
          action: show
        # Loyalty Operations
        - match: Equals(`mcp.params.name`, `get_loyalty_status`)
          action: show
        - match: Equals(`mcp.params.name`, `redeem_miles_for_flight`)
          action: show
        - match: Equals(`mcp.params.name`, `transfer_miles`)
          action: show
        - match: Equals(`mcp.params.name`, `purchase_miles`)
          action: show
      listDefaultAction: hide
      description: "Ticketing and sales tools for booking, modifications, and passenger services"
---
# MCP Middleware for Partner Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: partner-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  plugin:
    mcp:
      listPolicies:
        # Common
        - match: Equals(`mcp.params.name`, `ping`)
          action: show
        # # Codeshare Management
        # - match: Equals(`mcp.params.name`, `enroll_partner_flight`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `update_partner_schedule`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `manage_codeshare_inventory`)
        #   action: show
        # # Alliance Bookings
        # - match: Equals(`mcp.params.name`, `create_alliance_booking`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `create_interline_ticket`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `coordinate_baggage_transfer`)
        #   action: show
        # # Revenue Management
        # - match: Equals(`mcp.params.name`, `reconcile_partner_revenue`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `generate_prorate_report`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `manage_partner_loyalty_benefits`)
        #   action: show
        # # Partner Communications
        # - match: Equals(`mcp.params.name`, `send_partner_notification`)
        #   action: show
        # - match: Equals(`mcp.params.name`, `query_partner_availability`)
        #   action: show
      listDefaultAction: hide
---
# IngressRoute for User Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: user-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
  annotations:
    hub.traefik.io/api: user-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`user-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: user-assistance-mcp
---
# IngressRoute for Ticketing Agent MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: ticketing-agent-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
  annotations:
    hub.traefik.io/api: ticketing-agent-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`ticketing-agent.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: ticketing-agent-mcp
---
# IngressRoute for Partner Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: partner-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
  annotations:
    hub.traefik.io/api: partner-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`partner-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: partner-assistance-mcp
