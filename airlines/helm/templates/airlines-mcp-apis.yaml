---
# User Assistance MCP API - Customer Support Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: user-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  title: "User Assistance MCP"
  description: "Customer Support & Disruption Management - MCP tools for handling customer issues, flight disruptions, and support requests"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Ticketing Agent MCP API - Sales & Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: ticketing-agent-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  title: "Ticketing Agent MCP"
  description: "Sales & Ticketing Operations - MCP tools for booking, ticketing, check-in, and passenger services"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# Partner Assistance MCP API - B2B Operations Profile
apiVersion: hub.traefik.io/v1alpha1
kind: API
metadata:
  name: partner-assistance-api
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  title: "Partner Assistance MCP"
  description: "B2B & Alliance Operations - MCP tools for managing partner airlines, codeshares, and alliance operations"
  cors:
    allowHeadersList:
      - "*"
    allowOriginsList:
      - "*"
    allowMethodsList:
      - "*"
    exposeHeadersList:
      - "*"
    addVaryHeader: true
    allowCredentials: true
    allowOriginListRegex:
      - ".*"
    maxAge: 86400
---
# MCP Middleware for User Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: user-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
spec:
  plugin:
    mcp:
      gracefulErrors: true
      policies:
        - action: deny
          match: >-
            Equals(`mcp.params.name`, `ping`)
      defaultAction: allow
      listPolicies:
        - action: show
          match: >-
            Equals(`mcp.params.name`, `ping`)
      listDefaultAction: hide
---
# MCP Middleware for Ticketing Agent
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: ticketing-agent-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
spec:
  plugin:
    mcp:
      gracefulErrors: true
      policies:
        - match: >-
            Equals(`mcp.params.name`, `process_refund_request`) &&
            !Equals(`jwt.tools`, `process_refund_request`)
          action: deny
      defaultAction: allow
      listPolicies:
        - match: >-
            Equals(`mcp.params.name`, `process_refund_request`) &&
            !Equals(`jwt.tools`, `process_refund_request`)
          action: hide
      listDefaultAction: show
---
# MCP Middleware for Partner Assistance
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: partner-assistance-mcp
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
spec:
  plugin:
    mcp:
      gracefulErrors: true
      policies:
        - action: deny
          reason: "Ping is not allowed"
          match: >-
            Equals(`mcp.params.name`, `ping`)
      defaultAction: allow
      listPolicies:
        - action: show
          match: >-
            Equals(`mcp.params.name`, `ping`)
        - action: show
          match: >-
            Prefix(`mcp.params.name`, `enroll_partner`) ||
            Prefix(`mcp.params.name`, `update_partner`) ||
            Prefix(`mcp.params.name`, `create_alliance`) ||
            Prefix(`mcp.params.name`, `reconcile_partner`)
        - action: show
          match: >-
            Prefix(`mcp.params.name`, `get_airport`) ||
            Prefix(`mcp.params.name`, `generate_passenger`)
      listDefaultAction: hide
---
# IngressRoute for User Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: user-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: user-assistance
  annotations:
    hub.traefik.io/api: user-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`user-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: user-assistance-mcp
---
# IngressRoute for Ticketing Agent MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: ticketing-agent-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: ticketing-agent
  annotations:
    hub.traefik.io/api: ticketing-agent-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`ticketing-agent.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: ticketing-agent-mcp
---
# IngressRoute for Partner Assistance MCP
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: partner-assistance-mcp-route
  namespace: airlines
  labels:
    {{- include "airlines.labels" . | nindent 4 }}
    component: mcp
    profile: partner-assistance
  annotations:
    hub.traefik.io/api: partner-assistance-api
spec:
  entryPoints:
    {{- range .Values.entryPoints }}
    - {{ . }}
    {{- end }}
  routes:
    - kind: Rule
      match: Host(`partner-assistance.{{ .Values.domain }}`)
      services:
        - name: airlines-mcp
          port: 8080
      middlewares:
        - name: partner-assistance-mcp
